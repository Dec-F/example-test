<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <input type="text" id="in">

    <script>

        //单例模式
        function Single(name) {
            this.name = name;
            this.instance = null
        }
        Single.getInstance = function (name) {
            if (!this.instance) {
                this.instance = new Single(name)
            }
            return this.instance
        }
        let a = Single.getInstance('a1')
        let b = Single.getInstance('a2')
        

        //策略模式


//策略组
        let strategies={
            isEmpty: function (val,err) {
                if(val==''){
                    return err
                }
            },

            minLength: function(val,length,err) {
                if(val.length<length){
                    return err
                }
            },

            isMobile: function(val,err) {
                if(!/(^1[3|5|8][0-9]{9}$)/.test(val)){
                    return err
                }
            }
        }

//Context 用于接收用户需求
        function Validator () {
            this.cache=[]
        }
        Validator.prototype.add= function(dom,rule,err) {
            let args = rule.split(':');
            this.cache.push(function () {
                let strategy=args.shift();
                args.unshift(dom.value);
                args.push(err);
                return strategies[strategy].apply(dom,args)
            })
        }
        Validator.prototype.start= function() {
            let errArr=[]
            for(let i=0,validataFunc,len=this.cache.length;i<len;i++){
                validataFunc=this.cache[i];
                let err=validataFunc();
                if(err){
                    errArr.push(err)
                }
            }
            return errArr
        }


        //
        const validataFunc=()=>{
            let validator = new Validator();

            validator.add(domNode,'isEmpty','kong')
            validator.add(domNode,'minLength:10','chang')
            let err=validator.start();
            return err
        }

        let domNode = document.getElementById('in')

        domNode.onblur= function() {
            let errs = validataFunc();
            if (errs.length){
                errs.forEach(function(err) {
                    alert(err)
                })
            }
        }

// 自己写个例子

        {
            let strategies={
               S(base){
                    return base*4
               },
               A(base){
                   return base*3
               },
               B(base){
                   return base*2
               }
            }
            function calculate (base,lev) {
                
                   console.log(strategies[lev](base))
                
            }
            calculate(3000,'S')

        }


        

    </script>
</body>

</html>